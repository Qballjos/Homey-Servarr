<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Calendar</title><script src="/lib/homey.js"></script><style>body{margin:0;padding:10px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:0 0}.calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:5px 0}.view-toggle{display:flex;gap:5px;background:rgba(0,0,0,.1);border-radius:4px;padding:2px}.view-toggle button{padding:4px 8px;border:none;background:0 0;color:#666;font-size:11px;cursor:pointer;border-radius:3px;transition:all .2s}.view-toggle button.active{background:#4B0082;color:white}.nav-buttons{display:flex;gap:5px}.nav-buttons button{padding:4px 10px;border:none;background:rgba(0,0,0,.1);color:#333;font-size:12px;cursor:pointer;border-radius:3px}.current-date{font-weight:600;font-size:14px;color:#2c3e50}.calendar-container{margin-top:10px}.day-view{display:none}.day-view.active{display:block}.day-events{list-style:none;padding:0;margin:0}.day-events li{padding:8px;margin-bottom:6px;border-radius:4px;border-left:4px solid;background:rgba(255,255,255,.5);display:flex;align-items:center;gap:8px}.day-events li.radarr{border-left-color:#f1c40f}.day-events li.sonarr{border-left-color:#3498db}.day-events li.lidarr{border-left-color:#27ae60}.event-title{flex:1;font-weight:500;font-size:13px}.event-app{font-size:11px;padding:2px 6px;border-radius:3px;color:white;font-weight:600}.event-app.radarr{background:#f1c40f}.event-app.sonarr{background:#3498db}.event-app.lidarr{background:#27ae60}.event-downloaded{color:#27ae60;font-weight:700;font-size:16px}.week-view{display:none}.week-view.active{display:block}.week-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}.week-day{min-height:60px;padding:4px;border:1px solid rgba(0,0,0,.1);border-radius:3px;background:rgba(255,255,255,.3)}.week-day-header{font-size:10px;font-weight:600;margin-bottom:4px;color:#666}.week-day-number{font-size:12px;font-weight:700;margin-bottom:4px}.week-day.today{background:rgba(75,0,130,.1);border-color:#4B0082}.week-event{font-size:9px;padding:2px 4px;margin:2px 0;border-radius:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:white;font-weight:500}.week-event.radarr{background:#f1c40f}.week-event.sonarr{background:#3498db}.week-event.lidarr{background:#27ae60}.month-view{display:none}.month-view.active{display:block}.month-header{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:4px}.month-day-name{text-align:center;font-size:10px;font-weight:600;color:#666;padding:4px}.month-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}.month-day{min-height:50px;padding:3px;border:1px solid rgba(0,0,0,.1);border-radius:3px;background:rgba(255,255,255,.3);font-size:11px}.month-day.today{background:rgba(75,0,130,.15);border-color:#4B0082;font-weight:700}.month-day.other-month{opacity:.4}.month-day-number{font-size:11px;font-weight:600;margin-bottom:2px}.month-event{font-size:8px;padding:1px 3px;margin:1px 0;border-radius:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:white;font-weight:500}.month-event.radarr{background:#f1c40f}.month-event.sonarr{background:#3498db}.month-event.lidarr{background:#27ae60}.empty-state{text-align:center;padding:20px;color:#999;font-size:12px}</style></head><body><div class="calendar-header"><div class="view-toggle"><button id="btn-day">Day</button><button id="btn-week">Week</button><button id="btn-month" class="active">Month</button></div><div class="current-date" id="current-date"></div><div class="nav-buttons"><button id="btn-prev">‹</button><button id="btn-today">Today</button><button id="btn-next">›</button></div></div><div class="calendar-container"><div id="day-view" class="day-view"><ul class="day-events" id="day-events"></ul></div><div id="week-view" class="week-view"><div class="week-grid" id="week-grid"></div></div><div id="month-view" class="month-view active"><div class="month-header"><div class="month-day-name">Sun</div><div class="month-day-name">Mon</div><div class="month-day-name">Tue</div><div class="month-day-name">Wed</div><div class="month-day-name">Thu</div><div class="month-day-name">Fri</div><div class="month-day-name">Sat</div></div><div class="month-grid" id="month-grid"></div></div></div><script>Homey.ready();let calendarData=[],currentDate=new Date,currentView="month",appNames={radarr:"Radarr",sonarr:"Sonarr",lidarr:"Lidarr"};document.getElementById("btn-day").addEventListener("click",()=>setView("day")),document.getElementById("btn-week").addEventListener("click",()=>setView("week")),document.getElementById("btn-month").addEventListener("click",()=>setView("month")),document.getElementById("btn-prev").addEventListener("click",()=>navigate(-1)),document.getElementById("btn-next").addEventListener("click",()=>navigate(1)),document.getElementById("btn-today").addEventListener("click",()=>{currentDate=new Date,render()});function setView(e){currentView=e,document.querySelectorAll(".view-toggle button").forEach(e=>e.classList.remove("active")),document.getElementById(`btn-${e}`).classList.add("active"),document.querySelectorAll(".day-view, .week-view, .month-view").forEach(e=>e.classList.remove("active")),document.getElementById(`${e}-view`).classList.add("active"),render()}function navigate(e){"day"===currentView?currentDate.setDate(currentDate.getDate()+e):"week"===currentView?currentDate.setDate(currentDate.getDate()+7*e):"month"===currentView&&currentDate.setMonth(currentDate.getMonth()+e),render()}function formatDate(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function getEventsForDate(e){const t=e.toISOString().split("T")[0];return calendarData.filter(e=>e.date===t)}function renderDayView(){const e=getEventsForDate(currentDate),t=document.getElementById("day-events");if(0===e.length)return void(t.innerHTML='<div class="empty-state">No releases scheduled for this day</div>');t.innerHTML="",e.forEach(e=>{const r=document.createElement("li");r.className=e.app,r.innerHTML=`<span class="event-app ${e.app}">${appNames[e.app]}</span><span class="event-title">${escapeHtml(e.title)}</span>${e.hasFile?'<span class="event-downloaded">✓</span>':""}`,t.appendChild(r)})}function renderWeekView(){const e=document.getElementById("week-grid");e.innerHTML="";const t=new Date(currentDate);t.setDate(t.getDate()-t.getDay());for(let r=0;r<7;r++){const n=new Date(t);n.setDate(t.getDate()+r);const a=getEventsForDate(n),d=n.toDateString()===(new Date).toDateString(),l=document.createElement("div");l.className=`week-day ${d?"today":""}`,l.innerHTML=`<div class="week-day-header">${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r]}</div><div class="week-day-number">${n.getDate()}</div>${a.map(e=>`<div class="week-event ${e.app}" title="${escapeHtml(e.title)}">${escapeHtml(e.title)} ${e.hasFile?"✓":""}</div>`).join("")}`,e.appendChild(l)}}function renderMonthView(){const e=document.getElementById("month-grid");e.innerHTML="";const t=currentDate.getFullYear(),r=currentDate.getMonth(),n=new Date(t,r,1),a=new Date(n);a.setDate(n.getDate()-n.getDay());const d=new Date;d.setHours(0,0,0,0);for(let n=0;n<42;n++){const l=new Date(a);l.setDate(a.getDate()+n);const s=getEventsForDate(l),o=l.getTime()===d.getTime(),i=l.getMonth()!==r,c=document.createElement("div");c.className=`month-day ${o?"today":""} ${i?"other-month":""}`,c.innerHTML=`<div class="month-day-number">${l.getDate()}</div>${s.slice(0,3).map(e=>`<div class="month-event ${e.app}" title="${escapeHtml(e.title)}">${escapeHtml(e.title.substring(0,15))}${e.title.length>15?"...":""} ${e.hasFile?"✓":""}</div>`).join("")}${s.length>3?`<div style="font-size:9px;color:#666;margin-top:2px;">+${s.length-3} more</div>`:""}`,e.appendChild(c)}}function render(){document.getElementById("current-date").textContent=formatDate(currentDate),"day"===currentView?renderDayView():"week"===currentView?renderWeekView():"month"===currentView&&renderMonthView()}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async function loadCalendarData(){try{const result = await Homey.api("GET", "/widgets/calendar");if(result&&result.calendarData){calendarData=result.calendarData;render()}}catch(e){console.error("Error loading calendar data:",e);calendarData=[];render()}}loadCalendarData(),setInterval(loadCalendarData,6e4),Homey.on("capability:measure_today_releases",loadCalendarData);</script></body></html>
