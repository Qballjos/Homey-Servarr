<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Release Agenda</title><script src="/homey.js"></script><style>body{margin:0;padding:20px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:0 0}.widget-container{text-align:center}.count{font-size:48px;font-weight:700;color:#2c3e50;margin:10px 0}.label{font-size:14px;color:#7f8c8d;text-transform:uppercase;letter-spacing:1px}.subtitle{font-size:12px;color:#95a5a6;margin-top:5px}.list{list-style:none;padding:0;margin:12px 0 0 0;text-align:left}.list li{display:flex;align-items:center;gap:8px;padding:6px 4px;border-bottom:1px solid #ecf0f1;font-size:14px;color:#2c3e50}.flag{width:10px;height:10px;border-radius:2px;display:inline-block}.title{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.check{color:#27ae60;font-weight:700;min-width:18px;text-align:right}.errors{margin-top:10px;font-size:12px;color:#c0392b;text-align:left;line-height:1.4}</style></head><body><div class="widget-container"><div class="label">Today</div><div class="count" id="release-count">0</div><div class="subtitle">Planned releases</div><ul class="list" id="release-list"></ul><div class="errors" id="error-box"></div></div><script>
function logToServer(level, message, context) {
    try { Homey.api("POST", "/widgets/log", { level, message, context: { widget: "release_agenda", ...context } }).catch(() => {}); } catch(e) {}
}
Homey.ready();
logToServer("INFO", "Widget release_agenda ready");
const listEl=document.getElementById("release-list"),countEl=document.getElementById("release-count"),errorBox=document.getElementById("error-box"),appColors={sonarr:"#3498db",radarr:"#f1c40f",lidarr:"#27ae60"};
function renderList(e){if(listEl.innerHTML="",!e||0===e.length)return void(listEl.innerHTML="<li>No releases today</li>");for(const t of e){const r=appColors[t.app]||"#7f8c8d",n=t.hasFile?"âœ“":"",a=document.createElement("li");a.innerHTML=`<span class="flag" style="background:${r};"></span><span class="title">${t.title}</span><span class="check">${n}</span>`,listEl.appendChild(a)}}
function renderErrors(e){if(!e)return void(errorBox.innerHTML="");const t=Object.entries(e).filter(([e,t])=>t).map(([e,t])=>`${e}: ${t}`).join("<br>");errorBox.innerHTML=t?`<strong>Errors:</strong><br>${t}`:""}
async function load(){
    try{
        logToServer("DEBUG", "Requesting /widgets/agenda");
        const t = await Homey.api("GET", "/widgets/agenda");
        logToServer("DEBUG", "Received agenda data", { hasResult: !!t });
        if(t){const{releases:e,errors:r}=t;countEl.textContent=e?e.length:"0",renderList(e||[]),renderErrors(r||{})}
    }catch(e){
        logToServer("ERROR", "Error loading release data", { error: e.message });
        console.error("Error loading release data:",e)
    }
}
Homey.on("capability:measure_today_releases",load),load(),setInterval(load,6e4);</script></body></html>
